<table id="users">
  <tr>
    <td>
      <h1>Users</h1>
      <table id="datatable">
        <thead>
          <tr>
            <th>Avatar</th>
            <th>Email</th>
            <th>Username</th>
            <th>Firstname</th>
            <th>Lastname</th>
            <th>Created at</th>
            <th>Updated at</th>
            <th>Roles</th>
            <th colspan="3"></th>
          </tr>
        </thead>
        <tbody>
            <% @users.each do |user| %>
                <tr>
                    <td><%= image_tag user.gravatar_url(:size => 15, :default => "identicon") %></td>
                    <td><%= user.email %></td>
                    <td><%= user.username %></td>
                    <td><%= user.firstname %></td>
                    <td><%= user.lastname %></td>
                    <td><%= user.created_at.strftime("%Y-%m-%d %H:%M")%></td>
                    <td><%= user.updated_at.strftime("%Y-%m-%d %H:%M") %></td>
                    <td>
                      <% user.roles.each do |role| %>
                        <%= role.name %><br>
                      <% end %>
                      <%= 'No roles defined' if user.roles.empty? %>

                    </td>
                    <% if (can? :manage, User) || (user  == current_user) %>
                        <td><%= link_to 'Show', user %></td>
                        <td><%= link_to 'Edit', edit_user_path(user) %></td>
                        <td><%= link_to 'Destroy', user, method: :delete, data: { confirm: 'Are you sure?' } %></td>
                    <% end %>
                </tr>
            <% end %>
        </tbody>
      </table>
      <br>
      <%= link_to 'New User', new_user_path %>
    </td>
  </tr>
</table>